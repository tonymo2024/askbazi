# 算命程式系統設計

## 整體架構

### 主要模組
1. **輸入處理模組** (input_handler.py)
   - 處理用戶輸入的姓名和出生日期時間
   - 數據驗證和格式化

2. **八字計算模組** (bazi_calculator.py)
   - 天干地支計算
   - 八字排盤
   - 大運計算
   - 流年計算

3. **命理分析模組** (fortune_analyzer.py)
   - 五行分析
   - 喜用神計算
   - 性格分析
   - 運勢預測

4. **內容生成模組** (content_generator.py)
   - 根據八字生成各章節內容
   - 模板化內容生成
   - 個性化文字調整

5. **PDF生成模組** (pdf_generator.py)
   - PDF頁面佈局
   - 中文字體處理
   - 表格和文字排版

6. **主程式** (fortune_teller.py)
   - 整合所有模組
   - 用戶界面
   - 流程控制

## 數據結構設計

### 個人信息類
```python
class PersonInfo:
    def __init__(self, name, birth_date, birth_time, gender):
        self.name = name
        self.birth_date = birth_date  # datetime object
        self.birth_time = birth_time  # time object
        self.gender = gender
        self.lunar_date = None  # 農曆日期
```

### 八字信息類
```python
class BaziInfo:
    def __init__(self):
        self.year_pillar = None    # 年柱
        self.month_pillar = None   # 月柱
        self.day_pillar = None     # 日柱
        self.hour_pillar = None    # 時柱
        self.day_master = None     # 日主
        self.favorable_elements = []  # 喜用神
        self.dayun = []            # 大運
        self.liunian = []          # 流年
```

### 天干地支類
```python
class TianganDizhi:
    TIANGAN = ['甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸']
    DIZHI = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥']
    WUXING = {'甲': '木', '乙': '木', '丙': '火', '丁': '火', '戊': '土', 
              '己': '土', '庚': '金', '辛': '金', '壬': '水', '癸': '水'}
```

## 八字計算邏輯

### 1. 年柱計算
- 根據出生年份計算天干地支
- 考慮立春節氣的影響

### 2. 月柱計算
- 根據出生月份和年干計算
- 使用月建表

### 3. 日柱計算
- 使用萬年曆或算法計算
- 從基準日期推算

### 4. 時柱計算
- 根據出生時辰和日干計算
- 使用時辰對照表

### 5. 大運計算
- 男女順逆排法不同
- 計算起運年齡
- 每步大運10年

## 內容生成邏輯

### 章節內容模板

#### 1. 命主資料及八字大運
- 基本信息展示
- 八字排盤表格
- 大運時間表

#### 2. 人生總論
- 根據日主五行分析性格
- 根據八字組合分析人生特點
- 綜合運勢評估

#### 3. 事業總論
- 根據官殺星分析事業運
- 適合的職業方向
- 事業發展建議

#### 4. 財運總論
- 根據財星分析財運
- 財富累積方式
- 投資理財建議

#### 5. 姻緣總論
- 根據配偶星分析婚姻
- 感情模式分析
- 婚姻時機預測

#### 6. 健康總論
- 根據五行平衡分析健康
- 易患疾病預測
- 養生保健建議

#### 7. 六親總論
- 父母、兄弟、子女關係
- 人際交往特點
- 貴人運分析

#### 8. 五十年大運總論
- 每個大運期的特點
- 重要轉折點
- 發展機遇分析

#### 9. 十年流年預測
- 近十年運勢變化
- 每年重點事項
- 注意事項提醒

#### 10. 簡易催運指南
- 開運方法建議
- 風水調理
- 日常注意事項

## PDF生成設計

### 頁面佈局
- A4紙張大小
- 適當的邊距設置
- 中文字體支持

### 首頁設計
- 垂直標題欄
- 目錄框
- 八字表格
- 命主資料區

### 內容頁設計
- 章節標題
- 正文內容
- 頁碼
- 背景裝飾

### 字體和樣式
- 使用支持繁體中文的字體
- 標題、正文不同字號
- 適當的行距和字距

## 技術實現要點

### 依賴庫
- reportlab: PDF生成
- datetime: 日期時間處理
- lunar_python: 農曆轉換
- jieba: 中文文本處理

### 錯誤處理
- 輸入數據驗證
- 計算異常處理
- PDF生成錯誤處理

### 性能優化
- 模板緩存
- 計算結果緩存
- PDF生成優化

